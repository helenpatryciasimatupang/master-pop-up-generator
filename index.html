const poleMap = {};
poles.forEach(p => {
  const n = normalize(p.Name);
  if (!poleMap[n]) {
    poleMap[n] = { name: p.Name, coord: getLatLon(p.X, p.Y) };
  }
});

Object.values(poleMap)
  .sort((a,b)=>a.name.localeCompare(b.name,undefined,{numeric:true}))
  .forEach(p => {
    const fatSame = rows.find(r => {
      const c = getLatLon(r.X, r.Y);
      return r.FAT && c.lat === p.coord.lat && c.lon === p.coord.lon;
    });

    poleOutput.push({
      HOMEPASS_ID:'-',
      CLUSTER_NAME: area.area,
      PREFIX_ADDRESS:'-',
      STREET_NAME:'-',
      HOUSE_NUMBER:'-',
      BLOCK:'-',
      FLOOR:'-',
      RT:'-',
      RW:'-',
      DISTRICT: area.district,
      SUB_DISTRICT: area.subdistrict,
      FDT_CODE: area.fdt,
      FAT_CODE:'-',
      BUILDING_LATITUDE:'-',
      BUILDING_LONGITUDE:'-',
      'Category BizPass':'',
      'POST CODE': area.postcode,
      'ADDRESS POLE / FAT':'-',
      OV_UG:'O',
      HOUSE_COMMENT_:'',
      BUILDING_NAME:'-',
      TOWER:'-',
      APTN:'-',
      FIBER_NODE__HFC_:'-',
      ID_Area: area.idarea,
      Clamp_Hook_ID:'-',
      DEPLOYMENT_TYPE:'FAT EXT',
      NEED_SURVEY:'YES',
      'Pole ID (New)': p.name,
      'Coordinate (Lat) NEW': p.coord.lat,
      'Coordinate (Long) NEW': p.coord.lon,
      'Pole Provider (New)': 'LN (Existing)',
      'Pole Type': 'Pole 7/250',
      LINE:'',
      'FAT ID/NETWORK ID': fatSame ? fatSame.FAT : '-',
      Clamp_Hook_LATITUDE:'-',
      Clamp_Hook_LONGITUDE:'-'
    });
  });
